#!/bin/bash


set -ex


## Start triliovault-object-store service if backup target type is s3
<% if @backup_target_type == "s3" -%>
/usr/bin/python3 /usr/bin/s3vaultfuse.py --config-file=/etc/triliovault-object-store/triliovault-object-store.conf &
status=$?
if [ $status -ne 0 ]; then
  echo "Failed to start triliovault-object-store service: $status"
  exit $status
fi
sleep 20s

<% end -%>


## Start triliovaut-wlm-api service
/usr/bin/python3 /usr/bin/workloadmgr-workloads \
  --config-file=/etc/triliovault-wlm/triliovault-wlm.conf \
  --config-file=/etc/triliovault-wlm/triliovault-wlm-ids.conf

status=$?
if [ $status -ne 0 ]; then
  echo "Failed to start triliovaut-wlm-workloads: $status"
  exit $status
fi
